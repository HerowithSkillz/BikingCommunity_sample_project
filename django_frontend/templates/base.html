<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bike App</title>
</head>
<body>
  <nav>
    <a href="/">Home</a> |
    <a href="/bikes/">Bikes</a> |
    <a href="/login/">Login</a> |
    <a href="/register/">Register</a> |
    <a href="#" id="logout-link" style="display:none;">Logout</a>
  </nav>

  <hr/>
  <div id="user-info"></div>

  {% block content %}{% endblock %}

  <script>
    const BACKEND = "http://127.0.0.1:8001";
    // check current user at page load
    async function fetchCurrentUser() {
      try {
        const resp = await fetch(`${BACKEND}/api/auth/user/`, { credentials: 'include' });
        const data = await resp.json();
        const userInfo = document.getElementById('user-info');
        const logoutLink = document.getElementById('logout-link');
        if (data) {
          userInfo.innerText = "Signed in as: " + data.username;
          logoutLink.style.display = 'inline';
          logoutLink.onclick = async (e) => {
            e.preventDefault();
            await fetch(`${BACKEND}/api/auth/logout/`, {
              method: 'POST',
              credentials: 'include',
            });
            window.location.reload();
          };
        } else {
          userInfo.innerText = "Not signed in";
          logoutLink.style.display = 'none';
        }
      } catch (err) {
        console.error('user check failed', err);
      }
    }
    fetchCurrentUser();
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
